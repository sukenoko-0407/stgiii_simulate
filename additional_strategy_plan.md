# 追加戦略案（Additional Strategy Proposals）

## 背景

現在のBayesian Free-Wilson（UCB）が期待通りの性能を発揮しない原因：
- `ridge_alpha=1.0` が問題設定に対して不適切（スケール問題）
- 低SNR環境で正則化のshrinkageが信号を消失させる
- UCBの探索方向が不正確な不確実性推定に依存

---

## 案1: 経験ベイズ（Empirical Bayes）

**概要**: 事前分布のハイパーパラメータαをデータから推定

**手法**:
```
α_opt = argmax p(y | X, α)  # Marginal Likelihood最大化
```

**利点**:
- スケール問題を自動解決
- 低SNRでも適切な正則化
- 実装が比較的容易

**課題**:
- 毎ステップでの最適化コスト

---

## 案2: 階層ベイズ + Thompson Sampling

**概要**: 事前分布のパラメータも確率変数として扱い、Thompson Samplingで選択

**手法**:
```
1. 事後分布 p(θ | data) を計算
2. θをサンプリング
3. サンプルされたθで予測 → 最大セルを選択
```

**利点**:
- 自然な探索-搾取バランス
- UCBのβ調整が不要
- 理論的保証（Bayesian regret bound）

**課題**:
- 共分散行列からのサンプリングコスト O(p³)

---

## 案3: Gaussian Process（相互作用のモデル化）

**概要**: セル間の相関構造（相互作用含む）をカーネルでモデル化

**手法**:
```
f(cell) ~ GP(m(cell), k(cell, cell'))
k = k_additive + k_interaction
```

**利点**:
- 相互作用を暗黙的に捕捉
- 不確実性の自然な推定
- 柔軟なカーネル設計

**課題**:
- 計算コスト O(n³)
- Sparse GP等の近似が必要

---

## 案4: Bayesian-FW + 残差モデリング

**概要**: 加法モデルで主作用を推定し、残差をGPでモデル化

**手法**:
```
y = Xθ + f_residual(cell) + ε
  Xθ: Free-Wilson（主作用）
  f_residual ~ GP: 残差（相互作用等）
```

**利点**:
- 主作用は効率的に学習
- 残差GPで相互作用を捕捉
- θから主作用を解釈可能

**課題**:
- GPの計算コスト
- 主作用と残差の分離（identifiability）

---

## 比較表

| 案 | 実装難易度 | 計算コスト | 低SNR | 相互作用 |
|----|-----------|-----------|-------|---------|
| 1. 経験ベイズ | 中 | 中 | ◎ | × |
| 2. 階層ベイズ+TS | 中 | 中 | ◎ | × |
| 3. Gaussian Process | 高 | 高 | ○ | ◎ |
| 4. FW+残差GP | 高 | 高 | ◎ | ◎ |

---

## 推奨順序

1. **Phase 1**: 案1（経験ベイズ）でスケール問題を解決
2. **Phase 2**: 案2（Thompson Sampling）で探索-搾取を改善
3. **Phase 3**: 案3 or 案4 で相互作用をモデル化
